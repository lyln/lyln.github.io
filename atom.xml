<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>落影流年</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.wiredtiger.org/"/>
  <updated>2017-12-03T14:11:08.000Z</updated>
  <id>http://www.wiredtiger.org/</id>
  
  <author>
    <name>Lyln</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>MySQL笔记之版本升级和权限管理</title>
    <link href="http://www.wiredtiger.org/2017/12/03/2017-08-03-MySQL%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E5%92%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/"/>
    <id>http://www.wiredtiger.org/2017/12/03/2017-08-03-MySQL笔记之版本升级和权限管理/</id>
    <published>2017-12-03T14:11:08.000Z</published>
    <updated>2017-12-03T14:11:08.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="数据库升级"><a href="#数据库升级" class="headerlink" title="数据库升级"></a>数据库升级</h3><h4 id="1-环境说明："><a href="#1-环境说明：" class="headerlink" title="1. 环境说明："></a>1. <strong>环境说明：</strong></h4><p>一般说来，MySQL数据库的二进制数据文件，也就是<code>my.cnf</code>中的配置项<code>datadir</code>所在的位置，和我们MySQL应用程序安装的位置，是分开的，仅仅通过配置项告诉MySQL，数据库的数据存在<code>datadir</code>这个目录下。当程序和数据分离以后，方便我们对数据库应用程序做版本的升级或者回退。</p><h4 id="环境举例："><a href="#环境举例：" class="headerlink" title="环境举例："></a><strong>环境举例：</strong></h4><ul><li><p><em>MySQL安装目录：</em></p><ul><li><strong>MySQL 5.6.27:</strong> /usr/local/mysql-5.6.27-linux-glibc2.5-x86_64</li><li><strong>MySQL 5.7.9 :</strong> /usr/local/mysql-5.7.9-linux-glibc2.5-x86_64</li></ul></li><li><p><em>datadir目录：</em></p><ul><li>/data/mysq_data/</li></ul></li><li><p><em>初始环境：</em></p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">shell&gt; ll | grep mysql</div><div class="line">lrwxrwxrwx   1 root root    34 Nov 16 13:40 mysql -&gt; mysql-5.6.27-linux-glibc2.5-x86_64</div><div class="line">drwxr-xr-x  13 root mysql  4096 Nov 16 13:37 mysql-5.6.27-linux-glibc2.5-x86_64</div><div class="line">drwxr-xr-x   9 7161 wheel 4096 Oct 12 00:29 mysql-5.7.9-linux-glibc2.5-x86_64</div><div class="line"></div><div class="line">shell&gt; ll /data/mysql_data/</div><div class="line">total 13540</div><div class="line">-rw-rw---- 1 mysql mysql    65468 Nov 16 13:50 bin.000001</div><div class="line">-rw-rw---- 1 mysql mysql  1176237 Nov 16 13:50 bin.000002</div><div class="line">-rw-rw---- 1 mysql mysql       26 Nov 16 13:50 bin.index</div><div class="line">-rw-rw---- 1 mysql mysql     6882 Nov 16 13:50 error.log</div><div class="line">-rw-rw---- 1 mysql mysql      865 Nov 16 13:50 ib_buffer_pool</div><div class="line">-rw-rw---- 1 mysql mysql 12582912 Nov 16 13:50 ibdata1</div><div class="line">drwx------ 2 mysql mysql     4096 Nov 16 13:50 mysql</div><div class="line">drwx------ 2 mysql mysql     4096 Nov 16 13:50 performance_schema</div><div class="line">drwx------ 2 mysql mysql     4096 Nov 16 13:49 <span class="built_in">test</span></div></pre></td></tr></table></figure></li></ul><a id="more"></a><h4 id="版本升级"><a href="#版本升级" class="headerlink" title="版本升级"></a>版本升级</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">shell&gt; /etc/init.d/mysqld stop  <span class="comment">#安全的停止数据库的运行</span></div><div class="line">shell&gt; <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/</div><div class="line">shell&gt; unlink mysql</div><div class="line">shell&gt; ln -s mysql-5.7.9-linux-glibc2.5-x86_64 mysql </div><div class="line">        <span class="comment">#此时，MySQL的应用程序版本已经升级完成</span></div><div class="line">        <span class="comment">#/etc/init.d/mysqld</span></div><div class="line">        <span class="comment">#/etc/profile中PATH增加的/usr/local/mysql/bin</span></div><div class="line">        <span class="comment">#都不需要做任何的改变，即可将当前系统的mysql版本升级完成</span></div><div class="line">        <span class="comment">#注意：此时只是应用程序升级完成，系统表仍然还是5.6的版本</span></div><div class="line">        </div><div class="line"></div><div class="line">shell&gt; <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql</div><div class="line">shell&gt; chown root.mysql . -R</div><div class="line">shell&gt; cp /data/mysql_data/mysql /你的备份路径/mysql_5_6_27.backup -r</div><div class="line">       <span class="comment">#该步骤将mysql5.6.27版本的系统表进行了备份，以便将来可以回退</span></div><div class="line">       </div><div class="line">shell&gt; /etc/init.d/mysqld start </div><div class="line"><span class="comment">#此时 /etc/init.d/mysqld start  # 可以启动</span></div><div class="line"><span class="comment">#     且可以使用 mysql -u root -p （原密码） 进入数据库</span></div><div class="line"><span class="comment">#     show databases;存在test表，而没有sys表（数据的二进制文件兼容）</span></div><div class="line"><span class="comment">#     但是如果去看error.log会发现好多的WARNNING</span></div><div class="line"><span class="comment">#     所以，这个时候我们要去 upgrade 去升级</span></div><div class="line"></div><div class="line">       </div><div class="line">shell&gt; mysql_upgrade -p -s  </div><div class="line">        <span class="comment">#参数 -s 一定要加,表示只更新系统表，-s: upgrade-system-tables</span></div><div class="line">        <span class="comment">#如果不加-s,则会把所有库的表以5.7.9的方式重建，线上千万别这样操作</span></div><div class="line">        <span class="comment">#因为数据库二进制文件是兼容的，无需升级</span></div><div class="line">        <span class="comment">#什么时候不需要-s ? 当一些老的版本的存储格式需要新的特性，</span></div><div class="line">        <span class="comment">#                 来提升性能时，不加-s</span></div><div class="line">        <span class="comment">#即使通过slave进行升级，也推荐使用该方式升级，速度比较快</span></div><div class="line">   </div><div class="line">Enter password: </div><div class="line">The --upgrade-system-tables option was used, databases wont be touched.</div><div class="line">Checking <span class="keyword">if</span> update is needed.</div><div class="line">Checking server version.</div><div class="line">Running queries to upgrade MySQL server.</div><div class="line">Upgrading the sys schema.</div><div class="line">Upgrade process completed successfully.</div><div class="line">Checking <span class="keyword">if</span> update is needed.</div><div class="line">    </div><div class="line">shell&gt; mysql -u root -p</div><div class="line">Enter password: </div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 4</div><div class="line">Server version: 5.7.9-log MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt; show databases;</div><div class="line">+--------------------+</div><div class="line">| Database           |</div><div class="line">+--------------------+</div><div class="line">| information_schema |</div><div class="line">| mysql              |  <span class="comment"># 这个就是升级后的系统库，如果回退，将备份的拷贝回来覆盖即可</span></div><div class="line">| performance_schema |</div><div class="line">| sys                |  <span class="comment"># 5.7 新的sys库</span></div><div class="line">| <span class="built_in">test</span>               |  <span class="comment"># 5.6 中的test库</span></div><div class="line">+--------------------+</div><div class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure><p><code>5.1.X</code>、<code>5.5.X</code> 、<code>5.6.X</code> 是可以直接通过该方式升级到<code>5.7.X</code>。<code>5.0.X</code>未知，需要测试</p><p><strong>注意：</strong><br>如果原来数据二进制文件保存在<strong>/usr/local/<code>mysql-5.6.27</code>-linux-glibc2.5-x86_64/data</strong>目录下,在升级之前，要么将该目录的数据拷贝到新的你指定的data目录（比如<strong>/usr/local/<code>mysql-5.7.9</code>-linux-glibc2.5-x86_64/data</strong> ），要么修改<code>my.cnf</code>，将<code>datadir</code>指向<code>/usr/local/mysql-5.6.27-linux-glibc2.5-x86_64/data</code>，总之一定要确保<code>my.cnf</code>中的数据位置和你实际的数据位置是一致的，不管是默认的也好，还是你<code>datadir</code>指定的也好</p><h3 id="MySQL的连接登录"><a href="#MySQL的连接登录" class="headerlink" title="MySQL的连接登录"></a>MySQL的连接登录</h3><h4 id="1-几种登录方式"><a href="#1-几种登录方式" class="headerlink" title="1. 几种登录方式"></a>1. 几种登录方式</h4><pre><code>* 方式一 `mysql -p`    - 该方法默认使用root用户, 可使用`select user();`查看当前用户* 方式二 `mysql -S /tmp/mysql.sock -u root -p`  *密码A*    - 该方法适用于在安装MySQL主机上进行本地登录* 方式三 `mysql -h 127.0.0.1 -u root -p` *密码B*    - 使用`&apos;root&apos;@&apos;127.0.0.1&apos;`这个用户登录* 方式四 `mysql -h localhost -u root -p` *密码A*    - 该方式等价与【方式二】，且和【方式三】属于两个不同的“用户”</code></pre><h4 id="2-免密码登录"><a href="#2-免密码登录" class="headerlink" title="2. 免密码登录"></a>2. 免密码登录</h4><pre><code>* 方式一 `my.cnf`增加`[client]`标签       <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[client]   </div><div class="line">username=<span class="string">"root"</span>  </div><div class="line">password=<span class="string">"你的密码"</span></div></pre></td></tr></table></figure>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#单对定义不同的客户端</span></div><div class="line">[mysql] <span class="comment"># 这个是给/usr/loca/mysql/bin/mysql 使用的</span></div><div class="line">username=root</div><div class="line">password=<span class="string">"你的密码"</span></div><div class="line"></div><div class="line">[mysqladmin] <span class="comment"># 这个是给/usr/local/mysql/bin/mysqladmin使用的</span></div><div class="line">username=root</div><div class="line">password=<span class="string">"你的密码"</span></div></pre></td></tr></table></figure>    **每个不同的客户端需要定义不同的标签，使用`[client]`可以统一*** 方式二  login-path    <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">shell&gt; mysql_config_editor <span class="built_in">set</span> -G vm1 -S /tmp/mysql.sock -u root -p</div><div class="line">Enter password [输入root的密码]</div><div class="line"></div><div class="line">shell&gt; mysql_config_editor <span class="built_in">print</span> --all</div><div class="line">[vm1]</div><div class="line">user=root</div><div class="line">password=*****</div><div class="line">socket=/tmp/mysql.sock</div><div class="line"></div><div class="line"><span class="comment">#login</span></div><div class="line">shell&gt; mysql --login-path=vm1 <span class="comment"># 这样登录就不需要密码，且文件二进制存储 ,位置是 ~/.mylogin.cnf</span></div></pre></td></tr></table></figure>    **该方式相对安全。如果server被黑了，该二进制文件还是会被破解*** 方式三 `~/.my.cnf`, 自己当前家目录的下    <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Filename: ~/.my.cnf</span></div><div class="line">[client]</div><div class="line">username=<span class="string">"root"</span></div><div class="line">password=<span class="string">"你的密码"</span></div></pre></td></tr></table></figure></code></pre><h3 id="MySQL-参数介绍和设置"><a href="#MySQL-参数介绍和设置" class="headerlink" title="MySQL 参数介绍和设置"></a>MySQL 参数介绍和设置</h3><h4 id="1-参数的分类"><a href="#1-参数的分类" class="headerlink" title="1. 参数的分类"></a>1. 参数的分类</h4><pre><code>* 全局参数：GLOBAL    - 可修改参数    - 不可修改参数* 会话参数：SESSION    - 可修改参数    - 不可修改参数</code></pre><p>1: 用户可在线修改<code>非只读参数</code>，<code>只读参数</code>只能预先在配置文件中进行设置，通过重启数据库实例,方可生效。  </p><p>2: 所有的在线修改过的参数(GLOBAL/SESSION)，在重启后，都会丢失，不会写如<code>my.cnf</code>，无法将修改进行持久化</p><p>3: 有些参数，即存在于<code>GLOBAL</code>又存在于<code>SESSION</code>, 比如<code>autocommit</code> (PS：MySQL默认是提交的)</p><h4 id="2-查看参数"><a href="#2-查看参数" class="headerlink" title="2. 查看参数"></a>2. 查看参数</h4><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show variables; <span class="comment"># 显示当前mysql的所有参数，且无隐藏参数</span></div><div class="line">mysql&gt; show variables like <span class="string">"max_%"</span>; <span class="comment">#查以max_开头的变量</span></div></pre></td></tr></table></figure></code></pre><h4 id="3-设置参数"><a href="#3-设置参数" class="headerlink" title="3. 设置参数"></a>3. 设置参数</h4><pre><code>* 设置全局(GLOBAL)参数    <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mysql&gt; <span class="built_in">set</span> global slow_query_log = off; <span class="comment">#不加global，会提示错误</span></div><div class="line">                                       <span class="comment">#slow_query_log是全局参数</span></div><div class="line">mysql&gt; <span class="built_in">set</span> slow_query_log = off;  <span class="comment"># 下面就报错了，默认是会话参数</span></div><div class="line">ERROR 1229 (HY000): Variable <span class="string">'slow_query_log'</span> is a GLOBAL variable and should be <span class="built_in">set</span> with SET GLOBAL</div></pre></td></tr></table></figure>* 设置会话(SESSION)参数      <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql&gt; <span class="built_in">set</span> autocommit = 0;  <span class="comment"># 当前会话生效</span></div><div class="line"><span class="comment"># 或者</span></div><div class="line">mysql&gt; <span class="built_in">set</span> session autocommit = 0;  <span class="comment"># 当前会话生效</span></div></pre></td></tr></table></figure>    `autocommit`同样在`GLOBAL`中, 也有同样的参数    <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; <span class="built_in">set</span> global autocommit = 1; <span class="comment">#当前实例，全局生效</span></div></pre></td></tr></table></figure>    **注意：如果这个时候/etc/init.d/mysqld restart, 则全局的autocommit的值会变成默认值，或者依赖于my.cnf的设置值。**    执行的效果如下：    <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show variables like <span class="string">"slow%"</span>; <span class="comment"># 原值为ON</span></div><div class="line">+---------------------+----------+</div><div class="line">| Variable_name       | Value    |</div><div class="line">+---------------------+----------+</div><div class="line">| slow_launch_time    | 2        |</div><div class="line">| slow_query_log      | OFF      |</div><div class="line">| slow_query_log_file | slow.log |</div><div class="line">+---------------------+----------+</div><div class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select @@session.autocommit; <span class="comment"># 等价于 slect @@autocomit;</span></div><div class="line">+----------------------+</div><div class="line">| @@session.autocommit |</div><div class="line">+----------------------+</div><div class="line">|                    0 |</div><div class="line">+----------------------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; select @@global.autocommit;       </div><div class="line">+---------------------+</div><div class="line">| @@global.autocommit |</div><div class="line">+---------------------+</div><div class="line">|                   1 |</div><div class="line">+---------------------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure></code></pre><h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><h4 id="1-“用户-IP”的概念"><a href="#1-“用户-IP”的概念" class="headerlink" title="1. “用户 + IP”的概念"></a>1. “用户 + IP”的概念</h4><p>MySQL中同一个用户名，比如Bob,能否登录，以及用什么密码登录，可以访问什么库等等，都需要加上IP，才可以表示一个完整的用户标识</p><p><code>bob@127.0.0.1</code> 和 <code>bob@loalhost</code> 以及 <code>bob@192.168.1.100</code> 这三个其实是<code>不同</code>的 <strong>用户标识</strong> </p><h4 id="2-用户权限管理"><a href="#2-用户权限管理" class="headerlink" title="2. 用户权限管理"></a>2. 用户权限管理</h4><ul><li><p><strong>系统表权限信息:</strong></p><ul><li><strong>a) 用户名和IP是否允许</strong></li><li><strong>b) 查看mysql.user表</strong>  <code>// 查看全局所有库的权限</code></li><li><strong>c) 查看mysql.db表</strong>  <code>// 查看指定库的权限</code></li><li><strong>d) 查看mysql.table_priv表</strong> <code>// 查看指定表的权限</code></li><li><p><strong>e) 查看mysql.column_priv表</strong> <code>// 查看指定列的权限</code></p><p><strong>*tips</strong>: mysql&gt; desc [tablename]; 可以查看表的结构信息；*</p></li></ul></li><li><p><strong>常用权限：</strong></p><ul><li>SQL语句：SELECT、INSERT、UPDATE、DELETE、INDEX</li><li>存储过程：CREATE ROUTINE、ALTER ROUTINE、EXECUTE、TRIGGER</li><li><p>管理权限：SUPER、RELOAD、SHOW DATABASE、SHUTDOWN、</p><p><a href="https://dev.mysql.com/doc/refman/5.6/en/privileges-provided.html" target="_blank" rel="external">MySQL5.6权限</a></p></li></ul></li></ul><ul><li><p><strong>可选资源:</strong></p><ul><li>MAX_QUERIES_PER_HOUR <em>count</em></li><li>MAX_UPDATES_PER_HOUR <em>count</em></li><li>MAX_CONNECTIONS_PER_HOUR <em>count</em></li><li><p>MAX_USER_CONNECTIONS <em>count</em></p><p><strong>*tips:</strong>只能精确到小时，对于部分场景不适用，可以考虑中间件方式*</p></li></ul></li></ul><ul><li><strong>显示当前用户的权限</strong>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#这三个是同一个意思</span></div><div class="line">mysql&gt; show grants;</div><div class="line">mysql&gt; show grants <span class="keyword">for</span> current_user;</div><div class="line">mysql&gt; show grants <span class="keyword">for</span> current_user();</div></pre></td></tr></table></figure></li></ul><h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">mysql&gt; create user <span class="string">'bob'</span>@<span class="string">'127.0.0.1'</span> identified by <span class="string">'123'</span>; </div><div class="line">       <span class="comment">#创建一个认证用户为'bob'@'127.0.0.1',密码是123</span></div><div class="line">mysql&gt; grant all on NWDB.* to <span class="string">'bob'</span>@<span class="string">'127.0.0.1'</span>;</div><div class="line">       <span class="comment">#授予他NWDB库下面所有表的所有访问权限; *.*表示所有库的所有表</span></div><div class="line"></div><div class="line">mysql&gt; grant all on NWDB.* to <span class="string">'alice'</span>@<span class="string">'127.0.0.1'</span> identified by <span class="string">'123'</span>;</div><div class="line">       <span class="comment">#这个grant语句会搜索用户，如果用户不存在，则自动创建用户，</span></div><div class="line">       <span class="comment">#如果不带identified by, 则该用户名密码为空</span></div><div class="line"></div><div class="line">mysql&gt; grant all on *.* to <span class="string">'tom'</span>@<span class="string">'192.168.10.%'</span> identified by <span class="string">'123'</span> with grant option;</div><div class="line">       <span class="comment">#表示这个用户'tom'@'127.0.0.1'可以访问所有库的所有表，</span></div><div class="line">       <span class="comment">#同时，他还可以给其他用户授予权限(with grant option)，</span></div><div class="line">       <span class="comment">#注意如果，*.*改成了某一个指定的非USER库，</span></div><div class="line">       <span class="comment">#则tom没法去新建其他用户了，因为User库没有权限了</span></div><div class="line">       <span class="comment">#192.168.10.% 表示属于192.168.10.0/24网段的用户可以访问</span></div></pre></td></tr></table></figure><h3 id="撤销权限"><a href="#撤销权限" class="headerlink" title="撤销权限"></a>撤销权限</h3><ul><li><code>revoke</code> 关键字，该关键字只删除用户权限，不删除用户</li><li><code>revoke</code> 语法同<code>grant</code>一致, 从<code>grant ... to</code> 变为<code>revoke ... from</code></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;数据库升级&quot;&gt;&lt;a href=&quot;#数据库升级&quot; class=&quot;headerlink&quot; title=&quot;数据库升级&quot;&gt;&lt;/a&gt;数据库升级&lt;/h3&gt;&lt;h4 id=&quot;1-环境说明：&quot;&gt;&lt;a href=&quot;#1-环境说明：&quot; class=&quot;headerlink&quot; title=&quot;1. 环境说明：&quot;&gt;&lt;/a&gt;1. &lt;strong&gt;环境说明：&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;一般说来，MySQL数据库的二进制数据文件，也就是&lt;code&gt;my.cnf&lt;/code&gt;中的配置项&lt;code&gt;datadir&lt;/code&gt;所在的位置，和我们MySQL应用程序安装的位置，是分开的，仅仅通过配置项告诉MySQL，数据库的数据存在&lt;code&gt;datadir&lt;/code&gt;这个目录下。当程序和数据分离以后，方便我们对数据库应用程序做版本的升级或者回退。&lt;/p&gt;
&lt;h4 id=&quot;环境举例：&quot;&gt;&lt;a href=&quot;#环境举例：&quot; class=&quot;headerlink&quot; title=&quot;环境举例：&quot;&gt;&lt;/a&gt;&lt;strong&gt;环境举例：&lt;/strong&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;MySQL安装目录：&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MySQL 5.6.27:&lt;/strong&gt; /usr/local/mysql-5.6.27-linux-glibc2.5-x86_64&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MySQL 5.7.9 :&lt;/strong&gt; /usr/local/mysql-5.7.9-linux-glibc2.5-x86_64&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;datadir目录：&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;/data/mysq_data/&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;初始环境：&lt;/em&gt;&lt;/p&gt;
  &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;shell&amp;gt; ll | grep mysql&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;lrwxrwxrwx   1 root root    34 Nov 16 13:40 mysql -&amp;gt; mysql-5.6.27-linux-glibc2.5-x86_64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;drwxr-xr-x  13 root mysql  4096 Nov 16 13:37 mysql-5.6.27-linux-glibc2.5-x86_64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;drwxr-xr-x   9 7161 wheel 4096 Oct 12 00:29 mysql-5.7.9-linux-glibc2.5-x86_64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;shell&amp;gt; ll /data/mysql_data/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;total 13540&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-rw---- 1 mysql mysql    65468 Nov 16 13:50 bin.000001&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-rw---- 1 mysql mysql  1176237 Nov 16 13:50 bin.000002&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-rw---- 1 mysql mysql       26 Nov 16 13:50 bin.index&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-rw---- 1 mysql mysql     6882 Nov 16 13:50 error.log&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-rw---- 1 mysql mysql      865 Nov 16 13:50 ib_buffer_pool&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-rw---- 1 mysql mysql 12582912 Nov 16 13:50 ibdata1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;drwx------ 2 mysql mysql     4096 Nov 16 13:50 mysql&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;drwx------ 2 mysql mysql     4096 Nov 16 13:50 performance_schema&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;drwx------ 2 mysql mysql     4096 Nov 16 13:49 &lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="MySQL" scheme="http://www.wiredtiger.org/categories/MySQL/"/>
    
    
      <category term="MySQL笔记" scheme="http://www.wiredtiger.org/tags/MySQL%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>MySQL笔记之介绍和安装</title>
    <link href="http://www.wiredtiger.org/2017/12/03/2017-08-02-MySQL%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E8%A3%85/"/>
    <id>http://www.wiredtiger.org/2017/12/03/2017-08-02-MySQL笔记之介绍和安装/</id>
    <published>2017-12-03T14:09:45.000Z</published>
    <updated>2017-12-03T14:09:45.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="MySQL版本选择"><a href="#MySQL版本选择" class="headerlink" title="MySQL版本选择"></a>MySQL版本选择</h3><ol><li>MySQL5.6以后的版本，推荐使用官方版本。</li><li>Percona：在5.6版本以后，MySQL将Percon之前优化集成到官方版本中;</li><li>MariaDB：无INNODB;且核心代码较老</li><li>MySQL在5.6以后不断重构源码，安装包越来越大，功能和性能在持续改进</li></ol><h3 id="MySQL官方网站介绍"><a href="#MySQL官方网站介绍" class="headerlink" title="MySQL官方网站介绍"></a>MySQL官方网站介绍</h3><p>官方网站：<a href="http://www.mysql.com" target="_blank" rel="external">http://www.mysql.com</a></p><ol><li><p><strong>Developer Zone</strong>： MySQL开发工程师板块</p><ul><li>Articles： Oracle工程师自己的博客</li><li>Plant MySQL： 和MySQL相关从业人员的博客</li><li>Bugs：MySQL BugList</li><li>Worklog：开发记录</li><li>Labs：MySQL实验性项目</li></ul></li><li><p><strong>Downloads</strong>：MySQL下载</p><ul><li>Enterprise：MySQL企业版本相关，略过</li><li>Community：社区版，我们下载和使用社区版<ul><li>MySQL Community Server：MySQL Server</li><li>MySQL Fabric : 和管理相关的工具</li><li>MySQL Router：路由中间件</li><li>MySQL Utilities：MySQL应用程序包</li><li>MySQL Workbench：官方图型化管理界面</li><li>MySQL Proxy：MySQL代理。Alpha版本，不推荐</li></ul></li></ul></li><li><p><strong>Documentation</strong>：MySQL文档</p><ul><li>官方文档 版面更改，下载离线文档在左侧Menu的下面<ul><li><a href="http://downloads.mysql.com/docs/refman-5.7-en.a4.pdf" target="_blank" rel="external">PDF A4</a></li><li><a href="http://downloads.mysql.com/docs/refman-5.7-en.epub" target="_blank" rel="external">EPUB</a></li><li><a href="http://downloads.mysql.com/docs/refman-5.7-en.html-chapter.zip" target="_blank" rel="external">HTML</a></li></ul></li></ul></li></ol><a id="more"></a><h3 id="MySQL下载"><a href="#MySQL下载" class="headerlink" title="MySQL下载"></a>MySQL下载</h3><ol><li>推荐下载<code>Linux-Generic</code>版本</li><li><code>Source Code</code>版本主要作用是为了让开发人员研究源码使用，自己编译对性能提升不明显</li><li>不推荐<code>Version 5.5.X</code>，有部分bug</li><li>推荐使用<code>Version 5.6.X</code>和<code>Version 5.7.X</code></li></ol><p><em>下载地址：</em><br><a href="http://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.9-linux-glibc2.5-x86_64.tar.gz" target="_blank" rel="external">MySQL Community Server 5.7.9 Linux Generic x86-64bit</a><br><a href="http://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.27-linux-glibc2.5-x86_64.tar.gz" target="_blank" rel="external">MySQL Community Server 5.6.27 Linux Generic x86-64bit</a></p><h3 id="MySQL安装"><a href="#MySQL安装" class="headerlink" title="MySQL安装"></a>MySQL安装</h3><ol><li><p>安装通用步骤：</p><ul><li>解压缩<code>mysql-VERSION-linux-glibc2.5-x86_64.tar.gz</code></li><li>打开<code>INSTALL_BINARY</code> 文件，按照<code>shell&gt;</code>开头的步骤进行操作</li><li>将<code>export PATH=/安装路径/mysql/bin:$PATH</code>添加到<code>/etc/profile</code></li><li><code>chkconfig mysqld on</code>或者<code>chkconfig mysqld.server on</code>视你的环境而定，详细步骤如下</li></ul></li><li><p>MySQL 5.6.X 安装：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">shell&gt; yum install libaio <span class="comment"># Debain系用户:apt-get install libaio1</span></div><div class="line">shell&gt; groupadd mysql</div><div class="line">shell&gt; useradd -r -g mysql mysql</div><div class="line">shell&gt; <span class="built_in">cd</span> /usr/<span class="built_in">local</span></div><div class="line">shell&gt; tar zxvf /path/to/mysql-VERSION-OS.tar.gz</div><div class="line">shell&gt; ln -s full-path-to-mysql-VERSION-OS mysql</div><div class="line">shell&gt; <span class="built_in">cd</span> mysql</div><div class="line">shell&gt; chown -R mysql .</div><div class="line">shell&gt; chgrp -R mysql .</div><div class="line">shell&gt; scripts/mysql_install_db --user=mysql</div><div class="line">shell&gt; chown -R root .</div><div class="line">shell&gt; chown -R mysql data</div><div class="line">shell&gt; bin/mysqld_safe --user=mysql &amp;</div><div class="line"><span class="comment"># Next command is optional</span></div><div class="line">shell&gt; cp support-files/mysql.server /etc/init.d/mysql.server</div></pre></td></tr></table></figure></li><li><p>MySQL 5.7.X 安装     </p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">shell&gt; groupadd mysql</div><div class="line">shell&gt; useradd -r -g mysql mysql</div><div class="line">shell&gt; <span class="built_in">cd</span> /usr/<span class="built_in">local</span></div><div class="line">shell&gt; tar zxvf /path/to/mysql-VERSION-OS.tar.gz</div><div class="line">shell&gt; ln -s full-path-to-mysql-VERSION-OS mysql</div><div class="line">shell&gt; <span class="built_in">cd</span> mysql</div><div class="line">shell&gt; mkdir mysql-files</div><div class="line">shell&gt; chmod 770 mysql-files</div><div class="line">shell&gt; chown -R mysql .</div><div class="line">shell&gt; chgrp -R mysql .</div><div class="line">shell&gt; bin/mysqld --initialize --user=mysql <span class="comment">#该步骤中会产生零时</span></div><div class="line">                                            <span class="comment">#root@localhost密码</span></div><div class="line">                                            <span class="comment">#需要自己记录下来</span></div><div class="line">shell&gt; bin/mysql_ssl_rsa_setup          </div><div class="line">shell&gt; chown -R root .</div><div class="line">shell&gt; chown -R mysql data mysql-files</div><div class="line">shell&gt; bin/mysqld_safe --user=mysql &amp;</div><div class="line"><span class="comment"># Next command is optional</span></div><div class="line">shell&gt; cp support-files/mysql.server /etc/init.d/mysql.server</div></pre></td></tr></table></figure></li><li><p>验证安装</p><ul><li><code>data</code>目录在安装之前是空目录，安装完成后应该有<code>ibXXX</code>等文件</li><li>安装过程中输出的信息中，不应该含有<code>ERROR</code>信息，错误信息<code>默认</code>会写入到<code>$HOSTNAME.err</code>的文件中</li><li>通过<code>bin/mysql</code>命令（<em>5.7.X含有临时密码</em>）可以正常登录</li></ul></li><li><p>MySQL启动</p><ul><li><code>mysqld_safe --user=mysql &amp;</code> 即可启动，<code>mysqld_safe</code>是一个守护<code>mysqld</code>进程的脚本程序，旨在<code>mysqld</code>意外停止时，可以重启<code>mysqld</code>进程</li><li>也可以通过<code>INSTALL_BINARRY</code>中的的步骤，使用<code>/etc/init.d/mysql.server  start</code>进行启动（启动脚本以你复制的实际名字为准，通常改名为<code>mysqld</code>,即<code>/etc/init.d/mysqld start</code>）</li></ul></li></ol><h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><ol><li><p>模版配置文件<a href="https://github.com/lyln/mysql_best_configuration" target="_blank" rel="external">my.cnf</a></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line">[client]</div><div class="line">[mysql]</div><div class="line">prompt = [\\u@\\h][\\d]&gt;\\_</div><div class="line"></div><div class="line">[mysqld]</div><div class="line"><span class="comment">########basic settings########</span></div><div class="line">server-id = 11 </div><div class="line">port = 3306</div><div class="line">user = mysql</div><div class="line">bind_address = 10.166.224.32   <span class="comment">#根据实际情况修改</span></div><div class="line">autocommit = 1   <span class="comment">#自动提交</span></div><div class="line">character_set_server=utf8mb4</div><div class="line">skip_name_resolve = 1</div><div class="line">max_connections = 800</div><div class="line">max_connect_errors = 1000</div><div class="line">datadir = /data/mysql_data      <span class="comment">#根据实际情况修改,建议和程序分离存放</span></div><div class="line">transaction_isolation = READ-COMMITTED</div><div class="line">explicit_defaults_for_timestamp = 1</div><div class="line">join_buffer_size = 134217728</div><div class="line">tmp_table_size = 67108864</div><div class="line">tmpdir = /tmp</div><div class="line">max_allowed_packet = 16777216</div><div class="line">sql_mode = <span class="string">"STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER"</span></div><div class="line">interactive_timeout = 1800</div><div class="line">wait_timeout = 1800</div><div class="line">read_buffer_size = 16777216</div><div class="line">read_rnd_buffer_size = 33554432</div><div class="line">sort_buffer_size = 33554432</div><div class="line"><span class="comment">########log settings########</span></div><div class="line">log_error = error.log</div><div class="line">slow_query_log = 1</div><div class="line">slow_query_log_file = slow.log</div><div class="line">log_queries_not_using_indexes = 1</div><div class="line">log_slow_admin_statements = 1</div><div class="line">log_slow_slave_statements = 1</div><div class="line">log_throttle_queries_not_using_indexes = 10</div><div class="line">expire_logs_days = 90</div><div class="line">long_query_time = 2</div><div class="line">min_examined_row_limit = 100</div><div class="line"><span class="comment">########replication settings########</span></div><div class="line">master_info_repository = TABLE</div><div class="line">relay_log_info_repository = TABLE</div><div class="line">log_bin = bin.log</div><div class="line">sync_binlog = 1</div><div class="line">gtid_mode = on</div><div class="line">enforce_gtid_consistency = 1</div><div class="line">log_slave_updates</div><div class="line">binlog_format = row </div><div class="line">relay_log = relay.log</div><div class="line">relay_log_recovery = 1</div><div class="line">binlog_gtid_simple_recovery = 1</div><div class="line">slave_skip_errors = ddl_exist_errors</div><div class="line"><span class="comment">########innodb settings########</span></div><div class="line">innodb_page_size = 8192</div><div class="line">innodb_buffer_pool_size = 6G    <span class="comment">#根据实际情况修改</span></div><div class="line">innodb_buffer_pool_instances = 8</div><div class="line">innodb_buffer_pool_load_at_startup = 1</div><div class="line">innodb_buffer_pool_dump_at_shutdown = 1</div><div class="line">innodb_lru_scan_depth = 2000</div><div class="line">innodb_lock_wait_timeout = 5</div><div class="line">innodb_io_capacity = 4000</div><div class="line">innodb_io_capacity_max = 8000</div><div class="line">innodb_flush_method = O_DIRECT</div><div class="line">innodb_file_format = Barracuda</div><div class="line">innodb_file_format_max = Barracuda</div><div class="line">innodb_log_group_home_dir = /redolog/  <span class="comment">#根据实际情况修改</span></div><div class="line">innodb_undo_directory = /undolog/      <span class="comment">#根据实际情况修改</span></div><div class="line">innodb_undo_logs = 128</div><div class="line">innodb_undo_tablespaces = 3</div><div class="line">innodb_flush_neighbors = 1</div><div class="line">innodb_log_file_size = 4G               <span class="comment">#根据实际情况修改</span></div><div class="line">innodb_log_buffer_size = 16777216</div><div class="line">innodb_purge_threads = 4</div><div class="line">innodb_large_prefix = 1</div><div class="line">innodb_thread_concurrency = 64</div><div class="line">innodb_print_all_deadlocks = 1</div><div class="line">innodb_strict_mode = 1</div><div class="line">innodb_sort_buffer_size = 67108864 </div><div class="line"><span class="comment">########semi sync replication settings########</span></div><div class="line">plugin_dir=/usr/<span class="built_in">local</span>/mysql/lib/plugin      <span class="comment">#根据实际情况修改</span></div><div class="line">plugin_load = <span class="string">"rpl_semi_sync_master=semisync_master.so;rpl_semi_sync_slave=semisync_slave.so"</span></div><div class="line">loose_rpl_semi_sync_master_enabled = 1</div><div class="line">loose_rpl_semi_sync_slave_enabled = 1</div><div class="line">loose_rpl_semi_sync_master_timeout = 5000</div><div class="line"></div><div class="line">[mysqld-5.7]</div><div class="line">innodb_buffer_pool_dump_pct = 40</div><div class="line">innodb_page_cleaners = 4</div><div class="line">innodb_undo_log_truncate = 1</div><div class="line">innodb_max_undo_log_size = 2G</div><div class="line">innodb_purge_rseg_truncate_frequency = 128</div><div class="line">binlog_gtid_simple_recovery=1</div><div class="line">log_timestamps=system</div><div class="line">transaction_write_set_extraction=MURMUR32</div><div class="line">show_compatibility_56=on</div></pre></td></tr></table></figure></li><li><p>几个重要的参数配置和说明 </p><ul><li><p><code>innodb_log_file_size = 4G</code> :做实验可以更改的小点，线上环境推荐用4G，<br>以前5.5和5.1等版本之所以官方给的值很小，是因为太大后有bug，现在bug已经修复</p></li><li><p><code>innodb_undo_logs = 128</code>和<code>innodb_undo_tablespaces = 3</code>建议在安装之前就确定好该值，后续修改比较麻烦</p></li><li><code>[mysqld]</code>，<code>[mysqld-5.7]</code>这种tag表明了下面的配置在什么版本下才生效,<code>[mysqld]</code>下均生效</li><li><code>autocommit</code>,这个参数在5.5.X以后才有，安装5.6.X的时候要注意先把该参数注释掉，等安装完成后，再行打开, 5.7.X无需预先注释</li><li><code>datadir</code>, <code>innodb_log_group_home_dir</code>, <code>innodb_undo_directory</code>一定要注意他的权限是 <code>mysql:mysql</code></li></ul></li><li><p><code>my.cnf</code>问题</p><ul><li><p>使用<code>mysqld --help -vv | grep my.cnf</code>查看mysql的配置文件读取顺序</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Default options are <span class="built_in">read</span> from the following files <span class="keyword">in</span> the given order:</div><div class="line">/etc/my.cnf /etc/mysql/my.cnf ~/.my.cnf</div></pre></td></tr></table></figure></li><li><p>后读取的<code>my.cnf</code>中的配置，如果有相同项，会覆盖之前的配置</p></li><li>使用<code>--defaults-files</code>可指定配置文件</li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;MySQL版本选择&quot;&gt;&lt;a href=&quot;#MySQL版本选择&quot; class=&quot;headerlink&quot; title=&quot;MySQL版本选择&quot;&gt;&lt;/a&gt;MySQL版本选择&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;MySQL5.6以后的版本，推荐使用官方版本。&lt;/li&gt;
&lt;li&gt;Percona：在5.6版本以后，MySQL将Percon之前优化集成到官方版本中;&lt;/li&gt;
&lt;li&gt;MariaDB：无INNODB;且核心代码较老&lt;/li&gt;
&lt;li&gt;MySQL在5.6以后不断重构源码，安装包越来越大，功能和性能在持续改进&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;MySQL官方网站介绍&quot;&gt;&lt;a href=&quot;#MySQL官方网站介绍&quot; class=&quot;headerlink&quot; title=&quot;MySQL官方网站介绍&quot;&gt;&lt;/a&gt;MySQL官方网站介绍&lt;/h3&gt;&lt;p&gt;官方网站：&lt;a href=&quot;http://www.mysql.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.mysql.com&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Developer Zone&lt;/strong&gt;： MySQL开发工程师板块&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Articles： Oracle工程师自己的博客&lt;/li&gt;
&lt;li&gt;Plant MySQL： 和MySQL相关从业人员的博客&lt;/li&gt;
&lt;li&gt;Bugs：MySQL BugList&lt;/li&gt;
&lt;li&gt;Worklog：开发记录&lt;/li&gt;
&lt;li&gt;Labs：MySQL实验性项目&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Downloads&lt;/strong&gt;：MySQL下载&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Enterprise：MySQL企业版本相关，略过&lt;/li&gt;
&lt;li&gt;Community：社区版，我们下载和使用社区版&lt;ul&gt;
&lt;li&gt;MySQL Community Server：MySQL Server&lt;/li&gt;
&lt;li&gt;MySQL Fabric : 和管理相关的工具&lt;/li&gt;
&lt;li&gt;MySQL Router：路由中间件&lt;/li&gt;
&lt;li&gt;MySQL Utilities：MySQL应用程序包&lt;/li&gt;
&lt;li&gt;MySQL Workbench：官方图型化管理界面&lt;/li&gt;
&lt;li&gt;MySQL Proxy：MySQL代理。Alpha版本，不推荐&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Documentation&lt;/strong&gt;：MySQL文档&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;官方文档 版面更改，下载离线文档在左侧Menu的下面&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://downloads.mysql.com/docs/refman-5.7-en.a4.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;PDF A4&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://downloads.mysql.com/docs/refman-5.7-en.epub&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;EPUB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://downloads.mysql.com/docs/refman-5.7-en.html-chapter.zip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;HTML&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="MySQL" scheme="http://www.wiredtiger.org/categories/MySQL/"/>
    
    
      <category term="MySQL笔记" scheme="http://www.wiredtiger.org/tags/MySQL%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
</feed>
